---
date: 2021-03-05
title: "STM32F407_하드웨어 분석"
categories: Embedded_FreeRTOS
tags: jekyll
toc: true  
toc_sticky: true 
---

STM32F407 Discovery Kit H/W 분석
=============
이번 포스팅은 펌웨어로 FreeRTOS를 공부하기 위해 구입한 STM32F407 Discovery Kit의 H/W를 제 나름대로 분석한 내용을 정리하고자합니다.

STM32F407 Discovery Kit은 MCU Vendor인 ST 에서 자사 Chipset을 홍보하고 많이 쓰도록 하기위해 만든 평가판 키트입니다.

가격도 저렴해서 돈이 궁하신 대학생분들도 부담없이 사서 해볼수있습니다.

ST 사에서 제공하는 데이터시트, 보드 회로도와 Code generator인 'STM32CubeMX'를 통해 분석을 하였습니다.

꼼꼼히 분석한다면 ARM-Cortex 계열의 Architecture 를 사용하는 다른 Vendor의 MCU 분석에도 도움이 될거라 생각합니다.

틀린 점이나 지적할 점은 언제나 환영입니다.

# 1. STM32F407 MCU 분석
Dacument는 Datasheet, Reference Manual 총 2개가 있는데 각 H/W 특징 및 기능이 정리되어있는 Datasheet를 주로 보면서 할 것입니다.
## 1.1 Spec 간략 정리
* 1. Core(Architecture) : ARM 32-bit Cortex-M4 CPU with FPU, frequency up to 168 MHz
* 2. Memories
*    - Flash memory : Up to 1Mbytes
*    - SRAM : Up to 192+4Kbytes
*    - OTP memory : 512bytes
*    - Compact Flash, SRAM, PSRAM, NOR and NAND memories
* 3. LCD parallel interface
* 4. Clock, reset and supply management
*    - 1.8V to 3.6V
*    - Reset : POR, PDR, PVD and BOR
*    - 4-to-26 MHz crystal oscillator
*    - Internal 16 MHz factory-trimmed RC (1% accuracy)
* 5. Low-power operation
*    - Sleep, Stop and Standby modes
* 6. 3×12-bit, 2.4 MSPS A/D converters : up to 24channels 
* 7. 2×12-bit D/A converters
* 8. General-purpose DMA
* 9. Up to 17 timers
* 10. Debug mode
*    - Serial wire debug (SWD) & JTAG interfaces
*    - Cortex-M4 Embedded Trace Macrocel
* 11. Up to 140 I/O ports with interrupt capability
* 12. Up to 15 communication interfaces(I2C, U(S)ART, SPI, CAN, SDIO)
* 13. USB 2.0 full-speed device/host/OTG, 10/100 Ehternet MAC 
* 8- to 14-bit parallel camera interface up to 54 Mbytes/s
* True random number generator
```
1. 32bit, Cortex-M4, FPU, frequency up to 168 MHz
   - 소형 임베디드 SoC에서 사용하도록 설계된 코어입니다. 저전력 옵션을 사용할 수 있고 스마트 배터리/센서 등의 
     다양한 컨트롤러가 내장되어있기 때문에 소형 임베디드 시스템에 적용시 매우 유리할 거 같습니다.
   - FPU(Floating point unit) : 부동 소수점 장치. 부동 소수점 연산을 효율적이고 더 빠르게 처리해주는 모듈입니다.
     기존의 AVR와 같은 대부분의 8bit MCU에서는 정수형 ALU(Arithmetic logic unit)만 가지고 있어서 별도의 
     부동 소수점 연산 라이브러리를 올리고 사용했습니다. 상당히 연산속도가 느렸습니다.
     찾아보니 FPU의 사용 여부에 따라 속도가 약 10배정도 차이가 난다고하네요. 
   - 최대 168Mhz 로 채배해서 사용가능합니다. 이정도 속도면 FreeRTOS를 충분히 올려서 사용할 수 있을 거 같습니다.
```
```
2. Memories
   - Flash memory를 최대 1Mbyte까지 사용 가능합니다. 부트로더 영역을 따로 나누어서 관리해도 충분할 정도로 많습니다.
     추후에 부트로더를 올리는 방법도 찾아서 해봐야겠습니다.
   - CF, 각 종 SRAM, NOR/NAND 플래시 Controller를 지원한다고 합니다. FATFS또한 임베디드 시스템에 있어서 
     무조건 쓰는 것이니 꼭 해봐야겠습니다.
```
```
3. LCD parallel interface
   - 요즘 쓰는 RGB, LVDS, eDP interface가 아닌 옛날에 썼던 Bus interface 인거 같습니다.
     간단하게 CLCD를 붙일 수 있는 interface입니다. 요즘 추세에 잘 쓰지는 않을 거 같습니다.
```
```
4. LCD parallel interface
   - 요즘 쓰는 RGB, LVDS, eDP interface가 아닌 옛날에 썼던 Bus interface 인거 같습니다.
     간단하게 CLCD를 붙일 수 있는 interface입니다. 요즘 추세에 잘 쓰지는 않을 거 같습니다.
```
